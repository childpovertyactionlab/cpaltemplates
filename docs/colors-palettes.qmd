---
title: "Colors & Palettes"
subtitle: "Complete guide to the CPAL color system"
---

```{r}
#| label: setup
#| include: false
library(cpaltemplates)
library(ggplot2)
library(dplyr)
```

## Overview

The cpaltemplates color system provides 21 functions for working with CPAL's carefully designed color palettes. All colors are sourced from `_brand.yml` and designed for WCAG accessibility compliance.

---

## Primary Brand Colors

CPAL's 5 core brand colors form the foundation of all palettes:

```{r}
#| label: primary-colors
#| code-fold: show
cpal_colors_primary()
```

```{r}
#| label: primary-colors-table
#| echo: false

# Create a data frame with color info
primary_colors <- data.frame(
  Color = c("Midnight", "Deep Teal", "Coral", "Sage", "Slate", "Warm Gray"),
  Hex = c("#004855", "#006878", "#E86A50", "#5A8A6F", "#5C6B73", "#9BA8AB"),
  Use_Case = c(
    "Dark backgrounds, headers, primary emphasis",
    "Primary brand color, links, info states",
    "Accents, alerts, negative/error states",
    "Success states, positive indicators",
    "Secondary text, borders, muted elements",
    "Neutral backgrounds, disabled states"
  )
)

# Create gt table with color swatches
gt::gt(primary_colors) |>
  gt::cols_label(
    Color = "Color",
    Hex = "Hex Code",
    Use_Case = "Use Case"
  ) |>
  gt::text_transform(
    locations = gt::cells_body(columns = Hex),
    fn = function(x) {
      glue::glue(
        "<span style='display: inline-block; width: 20px; height: 20px; background-color: {x}; border-radius: 3px; vertical-align: middle; margin-right: 8px; border: 1px solid #ddd;'></span><code>{x}</code>"
      )
    }
  ) |>
  gt::fmt_markdown(columns = Hex) |>
  gt::tab_options(
    table.font.size = "14px",
    column_labels.font.weight = "bold"
  )
```

---

## Core Color Functions

### `cpal_colors()`

The main entry point for accessing any CPAL color or palette.

```{r}
#| label: cpal-colors-examples
# Get all primary colors
cpal_colors()

# Get a single color by name
cpal_colors("coral")

# Get multiple specific colors
cpal_colors(c("midnight", "coral", "sage"))
```

```{r}
#| label: cpal-colors-palettes
# Get a palette
cpal_colors("midnight_seq_5")

# Limit number of colors
cpal_colors("main", n = 3)

# Reverse palette order
cpal_colors("midnight_seq_5", reverse = TRUE)
```

---

### `cpal_colors_extended()`

Returns all 17+ colors including primary colors and shades:

```{r}
#| label: extended-colors
cpal_colors_extended()
```

---

## Viewing Palettes

### All Available Palettes

```{r}
#| label: list-palettes
list_cpal_palettes()
```

### Visual Palette Display

```{r}
#| label: view-all-palettes
#| fig-height: 8
#| fig-cap: "All CPAL color palettes"
view_cpal_palettes()
```

---

## Palette Types

### Categorical Palettes

For discrete data with distinct categories:

```{r}
#| label: categorical-palettes
#| fig-height: 5
#| fig-cap: "Categorical palettes for discrete data"
view_cpal_palettes(c("main", "main_3", "main_4", "main_5", "main_6", "binary", "status"))
```

**Usage example:**

```{r}
#| label: categorical-example
#| fig-cap: "Using categorical palette"
ggplot(mtcars, aes(x = factor(cyl), fill = factor(cyl))) +
  geom_bar() +
  scale_fill_cpal("main_3") +
  labs(title = "Count by Cylinder", x = "Cylinders", y = "Count") +
  theme_cpal() +
  theme(legend.position = "none")
```

---

### Sequential Palettes

For continuous or ordered data:

```{r}
#| label: sequential-palettes
#| fig-height: 4
#| fig-cap: "Sequential palettes for continuous data"
view_cpal_palettes(c("midnight_seq_4", "midnight_seq_5", "midnight_seq_6", "midnight_seq_8"))
```

**Usage example:**

```{r}
#| label: sequential-example
#| fig-cap: "Using sequential palette for continuous data"
ggplot(mtcars, aes(x = wt, y = mpg, color = hp)) +
  geom_point(size = 4) +
  scale_color_cpal_c("midnight_seq_5") +
  labs(
    title = "Fuel Efficiency by Weight",
    subtitle = "Color shows horsepower",
    x = "Weight (1000 lbs)",
    y = "Miles per Gallon",
    color = "Horsepower"
  ) +
  theme_cpal()
```

---

### Diverging Palettes

For data with a meaningful midpoint:

```{r}
#| label: diverging-palettes
#| fig-height: 4
#| fig-cap: "Diverging palettes for data with midpoints"
view_cpal_palettes(c("coral_midnight_3", "coral_midnight_5", "coral_midnight_7", "coral_midnight_9"))
```

**Usage example:**

```{r}
#| label: diverging-example
#| fig-cap: "Using diverging palette for change data"
# Create sample data with positive and negative changes
change_data <- data.frame(
  category = LETTERS[1:7],
  change = c(-15, -8, -2, 0, 5, 12, 20)
)

ggplot(change_data, aes(x = category, y = change, fill = change)) +
  geom_col() +
  scale_fill_gradient2(
    low = "#E86A50",
    mid = "#E8ECEE",
    high = "#004855",
    midpoint = 0
  ) +
  labs(
    title = "Year-over-Year Change",
    x = "Category",
    y = "Change (%)"
  ) +
  theme_cpal() +
  theme(legend.position = "none")
```

---

## ggplot2 Scale Functions

### Discrete Scales

```{r}
#| label: discrete-scale-example
#| fig-cap: "Using scale_color_cpal() for discrete data"
ggplot(mtcars, aes(x = wt, y = mpg, color = factor(cyl))) +
  geom_point(size = 3) +
  scale_color_cpal("main_3") +
  labs(
    title = "Discrete Color Scale",
    color = "Cylinders"
  ) +
  theme_cpal()
```

### Continuous Scales

```{r}
#| label: continuous-scale-example
#| fig-cap: "Using scale_fill_cpal_c() for continuous data"
ggplot(faithfuld, aes(waiting, eruptions, fill = density)) +
  geom_tile() +
  scale_fill_cpal_c("teal_seq_5") +
  labs(title = "Continuous Fill Scale") +
  theme_cpal()
```

---

## Color Interpolation

### `cpal_color_ramp()`

Generate smooth gradient between two colors:

```{r}
#| label: color-ramp
# Gradient from coral to midnight
cpal_color_ramp("coral", "midnight", n = 7)

# Using color names from brand.yml
cpal_color_ramp("midnight_1", "midnight", n = 5)
```

### `cpal_color_gradient()`

Create gradient through multiple colors:

```{r}
#| label: color-gradient
# Three-color gradient
cpal_color_gradient(c("coral", "neutral", "midnight"), n = 9)
```

---

## Color Validation (Accessibility)

### `validate_color_contrast()`

Check if two colors meet WCAG contrast requirements:

```{r}
#| label: contrast-validation
# Check deep_teal on white (should pass AA)
validate_color_contrast("#006878", "#FFFFFF")

# Check with AAA standard (stricter)
validate_color_contrast("#006878", "#FFFFFF", level = "AAA")

# Midnight on white (high contrast)
validate_color_contrast("#004855", "#FFFFFF", level = "AAA")
```

### `validate_brand_colors()`

Check all CPAL palette colors for accessibility:

```{r}
#| label: brand-validation
#| eval: false
validate_brand_colors()
```

This function prints a detailed report showing which colors pass WCAG AA/AAA standards on white and dark backgrounds.

---

## Choosing the Right Palette

### Quick Reference

| Data Type | Recommended Palettes |
|-----------|---------------------|
| **Categories (â‰¤3)** | `main_3`, `binary` |
| **Categories (4-5)** | `main_4`, `main_5` |
| **Categories (6-8)** | `main_6`, `main` |
| **Sequential/Continuous** | `midnight_seq_5`, `midnight_seq_6` |
| **Diverging (with midpoint)** | `coral_midnight_5`, `coral_midnight_7` |
| **Binary comparison** | `binary`, `compare` |
| **Status indicators** | `status` |

---

## Complete Example

```{r}
#| label: complete-example
#| fig-cap: "Complete visualization with CPAL colors and theme"
# Prepare data
car_data <- mtcars |>
  mutate(
    cylinders = factor(cyl),
    efficiency = ifelse(mpg > median(mpg), "High", "Low")
  )

# Create visualization
ggplot(car_data, aes(x = hp, y = mpg, color = cylinders, size = wt)) +
  geom_point(alpha = 0.7) +
  scale_color_cpal("main_3") +
  scale_size_continuous(range = c(2, 8)) +
  labs(
    title = "Vehicle Performance Analysis",
    subtitle = "Fuel efficiency by horsepower, colored by cylinder count",
    x = "Horsepower",
    y = "Miles per Gallon",
    color = "Cylinders",
    size = "Weight (1000 lbs)",
    caption = "Source: Motor Trend Car Road Tests (1974)"
  ) +
  theme_cpal()
```

---

## Next Steps

- [Themes & Styling](themes-styling.qmd) - Apply consistent themes to your plots
- [Plots & Output](plots-visualizations.qmd) - Save and export visualizations
- [Brand & Assets](brand-assets.qmd) - Customize brand configuration
